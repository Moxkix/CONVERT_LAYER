<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArcGIS Pro Layer Converter (.lyrx)</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .file-drop-area {
            transition: all 0.3s ease;
        }
        .file-drop-area.drag-over {
            background-color: rgba(99, 102, 241, 0.1);
            border-color: #6366f1;
            transform: scale(1.02);
        }
        .json-viewer {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        .highlight-change {
            animation: highlight 2s ease;
        }
        @keyframes highlight {
            0% { background-color: rgba(251, 191, 36, 0.3); }
            100% { background-color: transparent; }
        }
        .lang-switcher {
            transition: all 0.3s ease;
        }
        .lang-switcher:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useCallback, useEffect, useRef } = React;

        // Traducciones
        const translations = {
            es: {
                title: "Conversor de Capas ArcGIS Pro",
                subtitle: "Convierte archivos .lyrx entre Feature Layer y Raster Layer",
                dragDropTitle: "Arrastra tu archivo .lyrx aqu√≠",
                dragDropSubtitle: "o haz clic para seleccionar",
                uploadedFile: "Archivo Cargado",
                close: "Cerrar",
                fileName: "Nombre:",
                detectedType: "Tipo detectado:",
                featureLayer: "Feature Layer",
                rasterLayer: "Raster Layer",
                unknown: "Desconocido",
                fieldNameLabel: "Nombre del campo para clasificaci√≥n raster:",
                fieldNamePlaceholder: "Ej: Value, legenda_simple, CODIIGE",
                fieldNameHelp: "Este ser√° el campo utilizado en el colorizer del raster",
                convertToRaster: "üîÑ Convertir a Raster Layer",
                convertToFeature: "üîÑ Convertir a Feature Layer",
                conversionLog: "Registro de Conversi√≥n",
                conversionSuccess: "‚úÖ Conversi√≥n Exitosa",
                fileConverted: "Archivo convertido a",
                download: "Descargar Archivo Convertido",
                structureComparison: "Comparaci√≥n de Estructuras",
                original: "Original",
                converted: "Convertido",
                instructions: "üìñ Instrucciones de Uso",
                step1: "Carga un archivo .lyrx de ArcGIS Pro arrastr√°ndolo o seleccion√°ndolo",
                step2: "La aplicaci√≥n detectar√° autom√°ticamente si es Feature Layer o Raster Layer",
                step3: "Si es Feature Layer, especifica el nombre del campo para la clasificaci√≥n raster",
                step4: "Haz clic en convertir y descarga el archivo transformado",
                importantInfo: "‚ÑπÔ∏è Informaci√≥n Importante",
                info1: "‚Ä¢ La conversi√≥n preserva los colores y etiquetas de las clases",
                info2: "‚Ä¢ Feature ‚Üí Raster: Se crea un colorizer con valores √∫nicos",
                info3: "‚Ä¢ Raster ‚Üí Feature: Se crea un renderer con s√≠mbolos de pol√≠gono",
                info4: "‚Ä¢ Los archivos convertidos mantienen la estructura JSON v√°lida para ArcGIS Pro",
                footer: "Conversor de Capas ArcGIS Pro (.lyrx) - Feature ‚Üî Raster",
                logStart: "üîÑ Iniciando conversi√≥n",
                logTypeChanged: "‚úì Tipo de capa cambiado",
                logPropsRemoved: "‚úì Propiedades eliminadas",
                logPropsAdded: "‚úì Propiedades a√±adidas",
                logDataConnAdded: "‚úì Conexi√≥n de datos a√±adida",
                logColorizerCreated: "‚úì Colorizer creado con",
                logRendererCreated: "‚úì Renderer creado con",
                logClasses: "clases",
                logFieldClass: "‚úì Campo de clasificaci√≥n:",
                logTableAdded: "‚úì Tabla a√±adida",
                logCompleted: "‚úÖ Conversi√≥n completada exitosamente",
                logExtractedClass: "‚úì Extra√≠da clase:",
                log3DProps: "‚úì Propiedades 3D a√±adidas",
                logFeatureProps: "‚úì Propiedades de Feature a√±adidas"
            },
            en: {
                title: "ArcGIS Pro Layer Converter",
                subtitle: "Convert .lyrx files between Feature Layer and Raster Layer",
                dragDropTitle: "Drag your .lyrx file here",
                dragDropSubtitle: "or click to browse",
                uploadedFile: "Uploaded File",
                close: "Close",
                fileName: "Name:",
                detectedType: "Detected type:",
                featureLayer: "Feature Layer",
                rasterLayer: "Raster Layer",
                unknown: "Unknown",
                fieldNameLabel: "Field name for raster classification:",
                fieldNamePlaceholder: "Ex: Value, legenda_simple, CODIIGE",
                fieldNameHelp: "This will be the field used in the raster colorizer",
                convertToRaster: "üîÑ Convert to Raster Layer",
                convertToFeature: "üîÑ Convert to Feature Layer",
                conversionLog: "Conversion Log",
                conversionSuccess: "‚úÖ Conversion Successful",
                fileConverted: "File converted to",
                download: "Download Converted File",
                structureComparison: "Structure Comparison",
                original: "Original",
                converted: "Converted",
                instructions: "üìñ How to Use",
                step1: "Load an ArcGIS Pro .lyrx file by dragging or selecting it",
                step2: "The app will automatically detect if it's a Feature Layer or Raster Layer",
                step3: "If it's a Feature Layer, specify the field name for raster classification",
                step4: "Click convert and download the transformed file",
                importantInfo: "‚ÑπÔ∏è Important Information",
                info1: "‚Ä¢ Conversion preserves class colors and labels",
                info2: "‚Ä¢ Feature ‚Üí Raster: Creates a colorizer with unique values",
                info3: "‚Ä¢ Raster ‚Üí Feature: Creates a renderer with polygon symbols",
                info4: "‚Ä¢ Converted files maintain valid JSON structure for ArcGIS Pro",
                footer: "ArcGIS Pro Layer Converter (.lyrx) - Feature ‚Üî Raster",
                logStart: "üîÑ Starting conversion",
                logTypeChanged: "‚úì Layer type changed",
                logPropsRemoved: "‚úì Properties removed",
                logPropsAdded: "‚úì Properties added",
                logDataConnAdded: "‚úì Data connection added",
                logColorizerCreated: "‚úì Colorizer created with",
                logRendererCreated: "‚úì Renderer created with",
                logClasses: "classes",
                logFieldClass: "‚úì Classification field:",
                logTableAdded: "‚úì Table added",
                logCompleted: "‚úÖ Conversion completed successfully",
                logExtractedClass: "‚úì Extracted class:",
                log3DProps: "‚úì 3D properties added",
                logFeatureProps: "‚úì Feature properties added"
            }
        };

        // Componente de selector de idioma mejorado
        function LanguageSelector({ language, setLanguage }) {
            return (
                <div className="absolute top-4 right-4 z-10">
                    <div className="flex gap-2 bg-purple-700 bg-opacity-50 p-1 rounded-lg backdrop-blur-sm">
                        <button
                            onClick={() => setLanguage('es')}
                            className={`lang-switcher px-3 py-1 rounded-md font-medium text-sm transition-all ${
                                language === 'es' 
                                    ? 'bg-white text-purple-700 shadow-lg scale-105' 
                                    : 'text-white hover:bg-purple-600 hover:scale-105'
                            }`}
                            title="Cambiar a Espa√±ol"
                            aria-label="Cambiar idioma a Espa√±ol"
                        >
                            üá™üá∏ ES
                        </button>
                        <button
                            onClick={() => setLanguage('en')}
                            className={`lang-switcher px-3 py-1 rounded-md font-medium text-sm transition-all ${
                                language === 'en' 
                                    ? 'bg-white text-purple-700 shadow-lg scale-105' 
                                    : 'text-white hover:bg-purple-600 hover:scale-105'
                            }`}
                            title="Switch to English"
                            aria-label="Switch language to English"
                        >
                            üá¨üáß EN
                        </button>
                    </div>
                </div>
            );
        }

        function LyrxConverter() {
            // Cargar idioma preferido de localStorage o detectar del navegador
            const [language, setLanguage] = useState(() => {
                const savedLang = localStorage.getItem('preferredLanguage');
                if (savedLang) return savedLang;
                
                // Detectar idioma del navegador
                const browserLang = navigator.language || navigator.userLanguage;
                if (browserLang && browserLang.startsWith('en')) {
                    return 'en';
                }
                return 'es'; // Por defecto espa√±ol
            });
            
            // Guardar idioma preferido, actualizar atributos del documento
            useEffect(() => {
                localStorage.setItem('preferredLanguage', language);
                document.documentElement.lang = language;
                document.title = language === 'es' 
                    ? 'Conversor de Capas ArcGIS Pro (.lyrx)'
                    : 'ArcGIS Pro Layer Converter (.lyrx)';
            }, [language]);
            
            const [inputFile, setInputFile] = useState(null);
            const [inputContent, setInputContent] = useState(null);
            const [outputContent, setOutputContent] = useState(null);
            const [layerType, setLayerType] = useState(null);
            const [convertedType, setConvertedType] = useState(null);
            const [isDragging, setIsDragging] = useState(false);
            const [showComparison, setShowComparison] = useState(false);
            const [conversionLog, setConversionLog] = useState([]);
            const [fieldName, setFieldName] = useState('');
            const fileInputRef = useRef(null);

            // Funci√≥n para obtener texto traducido
            const t = (key) => translations[language][key] || key;

            const detectLayerType = (content) => {
                if (content.layerDefinitions && content.layerDefinitions[0]) {
                    const layerDef = content.layerDefinitions[0];
                    if (layerDef.type === 'CIMFeatureLayer') {
                        return 'feature';
                    } else if (layerDef.type === 'CIMRasterLayer') {
                        return 'raster';
                    }
                }
                return 'unknown';
            };

            const extractFeatureSymbology = (featureDef) => {
                const classes = [];
                const log = [];
                
                if (featureDef.renderer && featureDef.renderer.groups) {
                    featureDef.renderer.groups.forEach(group => {
                        if (group.classes) {
                            group.classes.forEach(cls => {
                                let color = [194, 194, 194, 100]; // Default gray
                                
                                if (cls.symbol && cls.symbol.symbol && cls.symbol.symbol.symbolLayers) {
                                    cls.symbol.symbol.symbolLayers.forEach(layer => {
                                        if (layer.type === 'CIMSolidFill' && layer.color) {
                                            color = layer.color.values;
                                        }
                                    });
                                }
                                
                                const values = cls.values ? cls.values.map(v => v.fieldValues ? v.fieldValues[0] : '') : [''];
                                
                                classes.push({
                                    label: cls.label || values[0] || 'Sin etiqueta',
                                    values: values,
                                    color: color
                                });
                                
                                log.push(`${t('logExtractedClass')} ${cls.label || values[0]}`);
                            });
                        }
                    });
                }
                
                return { classes, log };
            };

            const extractRasterSymbology = (rasterDef) => {
                const classes = [];
                const log = [];
                
                if (rasterDef.colorizer && rasterDef.colorizer.groups) {
                    rasterDef.colorizer.groups.forEach(group => {
                        if (group.classes) {
                            group.classes.forEach(cls => {
                                classes.push({
                                    label: cls.label || cls.values[0] || 'Sin etiqueta',
                                    values: cls.values || [cls.label],
                                    color: cls.color ? cls.color.values : [194, 194, 194, 100]
                                });
                                
                                log.push(`${t('logExtractedClass')} ${cls.label || cls.values[0]}`);
                            });
                        }
                    });
                }
                
                return { classes, log };
            };

            const convertToRaster = (featureContent, customFieldName) => {
                const log = [`${t('logStart')} Feature ‚Üí Raster...`];
                const converted = JSON.parse(JSON.stringify(featureContent));
                
                if (converted.layerDefinitions && converted.layerDefinitions[0]) {
                    const featureDef = converted.layerDefinitions[0];
                    
                    // Extraer simbolog√≠a
                    const { classes, log: extractLog } = extractFeatureSymbology(featureDef);
                    log.push(...extractLog);
                    
                    // Cambiar tipo de capa
                    featureDef.type = 'CIMRasterLayer';
                    log.push(`${t('logTypeChanged')} CIMRasterLayer`);
                    
                    // Eliminar propiedades espec√≠ficas de feature
                    delete featureDef.featureTable;
                    delete featureDef.renderer;
                    delete featureDef.featureTemplates;
                    delete featureDef.htmlPopupFormat;
                    delete featureDef.labelClasses;
                    delete featureDef.layer3DProperties;
                    delete featureDef.scaleSymbols;
                    delete featureDef.snappable;
                    log.push(`${t('logPropsRemoved')} Feature`);
                    
                    // A√±adir conexi√≥n de datos raster
                    featureDef.dataConnection = {
                        type: "CIMStandardDataConnection",
                        workspaceConnectionString: "DATABASE=.\\SIOSE.gdb",
                        workspaceFactory: "FileGDB",
                        dataset: featureDef.name || "CONVERTED_RASTER",
                        datasetType: "esriDTRasterDataset"
                    };
                    log.push(`${t('logDataConnAdded')} raster`);
                    
                    // Crear colorizer con las clases extra√≠das
                    const fieldNameToUse = customFieldName || 'Value';
                    featureDef.colorizer = {
                        type: "CIMRasterUniqueValueColorizer",
                        resamplingType: "NearestNeighbor",
                        noDataColor: {
                            type: "CIMRGBColor",
                            values: [255, 255, 255, 0]
                        },
                        fieldName: fieldNameToUse,
                        groups: [{
                            type: "CIMRasterUniqueValueGroup",
                            classes: classes.map(cls => ({
                                type: "CIMRasterUniqueValueClass",
                                values: cls.values,
                                label: cls.label,
                                color: {
                                    type: "CIMRGBColor",
                                    values: cls.color
                                }
                            })),
                            heading: fieldNameToUse
                        }]
                    };
                    log.push(`${t('logColorizerCreated')} ${classes.length} ${t('logClasses')}`);
                    log.push(`${t('logFieldClass')} ${fieldNameToUse}`);
                    
                    // A√±adir tabla de atributos raster
                    featureDef.attributeTable = {
                        type: "CIMRasterTable",
                        displayField: fieldNameToUse,
                        editable: true
                    };
                    log.push(`${t('logTableAdded')} raster`);
                    
                    // Actualizar referencias de ruta
                    if (converted.layers && converted.layers[0]) {
                        const path = converted.layers[0].replace('.json', '_RASTER.json');
                        converted.layers[0] = path;
                        featureDef.uRI = path;
                    }
                }
                
                log.push(t('logCompleted'));
                return { converted, log };
            };

            const convertToFeature = (rasterContent) => {
                const log = [`${t('logStart')} Raster ‚Üí Feature...`];
                const converted = JSON.parse(JSON.stringify(rasterContent));
                
                if (converted.layerDefinitions && converted.layerDefinitions[0]) {
                    const rasterDef = converted.layerDefinitions[0];
                    
                    // Extraer simbolog√≠a
                    const { classes, log: extractLog } = extractRasterSymbology(rasterDef);
                    log.push(...extractLog);
                    
                    // Cambiar tipo de capa
                    rasterDef.type = 'CIMFeatureLayer';
                    log.push(`${t('logTypeChanged')} CIMFeatureLayer`);
                    
                    // Eliminar propiedades espec√≠ficas de raster
                    delete rasterDef.dataConnection;
                    delete rasterDef.colorizer;
                    delete rasterDef.attributeTable;
                    log.push(`${t('logPropsRemoved')} Raster`);
                    
                    // A√±adir propiedades 3D
                    rasterDef.layer3DProperties = {
                        type: "CIM3DLayerProperties",
                        castShadows: true,
                        isLayerLit: true,
                        layerFaceCulling: "None",
                        maxDistance: -1,
                        minDistance: -1,
                        verticalExaggeration: 1,
                        exaggerationMode: "ScaleZ",
                        lighting: "OneSideDataNormal",
                        optimizeMarkerTransparency: true
                    };
                    log.push(t('log3DProps'));
                    
                    // Crear renderer con las clases extra√≠das
                    rasterDef.renderer = {
                        type: "CIMUniqueValueRenderer",
                        fields: ["legenda_simple"],
                        defaultSymbol: {
                            type: "CIMSymbolReference",
                            symbol: {
                                type: "CIMPolygonSymbol",
                                symbolLayers: [{
                                    type: "CIMSolidFill",
                                    enable: true,
                                    color: {
                                        type: "CIMRGBColor",
                                        values: [225, 225, 225, 100]
                                    }
                                }]
                            }
                        },
                        groups: [{
                            type: "CIMUniqueValueGroup",
                            classes: classes.map(cls => ({
                                type: "CIMUniqueValueClass",
                                label: cls.label,
                                patch: "Default",
                                symbol: {
                                    type: "CIMSymbolReference",
                                    symbol: {
                                        type: "CIMPolygonSymbol",
                                        symbolLayers: [{
                                            type: "CIMSolidFill",
                                            enable: true,
                                            color: {
                                                type: "CIMRGBColor",
                                                values: cls.color
                                            }
                                        }],
                                        angleAlignment: "Map"
                                    }
                                },
                                values: cls.values.map(v => ({
                                    type: "CIMUniqueValue",
                                    fieldValues: [v]
                                })),
                                visible: true
                            })),
                            heading: "legenda_simple"
                        }],
                        isDefaultSymbolVisible: true,
                        polygonSymbolColorTarget: "Fill"
                    };
                    log.push(`${t('logRendererCreated')} ${classes.length} ${t('logClasses')}`);
                    
                    // A√±adir propiedades de feature
                    rasterDef.autoGenerateFeatureTemplates = true;
                    rasterDef.scaleSymbols = true;
                    rasterDef.snappable = true;
                    log.push(t('logFeatureProps'));
                    
                    // A√±adir tabla de features b√°sica
                    rasterDef.featureTable = {
                        type: "CIMFeatureTable",
                        displayField: "legenda_simple",
                        editable: true
                    };
                    log.push(`${t('logTableAdded')} features`);
                    
                    // Actualizar referencias de ruta
                    if (converted.layers && converted.layers[0]) {
                        const path = converted.layers[0].replace('_RASTER', '').replace('.json', '_FEATURE.json');
                        converted.layers[0] = path;
                        rasterDef.uRI = path;
                    }
                }
                
                log.push(t('logCompleted'));
                return { converted, log };
            };

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (file && file.name.endsWith('.lyrx')) {
                    processFile(file);
                }
            };

            const processFile = (file) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const content = JSON.parse(e.target.result);
                        const type = detectLayerType(content);
                        
                        setInputFile(file);
                        setInputContent(content);
                        setLayerType(type);
                        setOutputContent(null);
                        setConvertedType(null);
                        setConversionLog([]);
                        setShowComparison(false);
                        
                        // Extraer nombre de campo si es raster
                        if (type === 'raster' && content.layerDefinitions[0].colorizer) {
                            setFieldName(content.layerDefinitions[0].colorizer.fieldName || 'Value');
                        } else {
                            setFieldName('Value');
                        }
                    } catch (error) {
                        alert('Error al leer el archivo: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };


            const handleDragOver = (e) => {
                e.preventDefault();
                setIsDragging(true);
            };

            const handleDragLeave = (e) => {
                e.preventDefault();
                setIsDragging(false);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setIsDragging(false);
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].name.endsWith('.lyrx')) {
                    processFile(files[0]);
                }
            };

            const performConversion = () => {
                if (layerType === 'feature') {
                    const { converted, log } = convertToRaster(inputContent, fieldName);
                    setOutputContent(converted);
                    setConvertedType('raster');
                    setConversionLog(log);
                } else if (layerType === 'raster') {
                    const { converted, log } = convertToFeature(inputContent);
                    setOutputContent(converted);
                    setConvertedType('feature');
                    setConversionLog(log);
                }
                setShowComparison(true);
            };

            const downloadConvertedFile = () => {
                if (outputContent && inputFile) {
                    const blob = new Blob([JSON.stringify(outputContent, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    const suffix = convertedType === 'raster' ? '_RASTER' : '_FEATURE';
                    a.href = url;
                    a.download = inputFile.name.replace('.lyrx', `${suffix}.lyrx`);
                    a.click();
                    URL.revokeObjectURL(url);
                }
            };

            const reset = () => {
                setInputFile(null);
                setInputContent(null);
                setOutputContent(null);
                setLayerType(null);
                setConvertedType(null);
                setConversionLog([]);
                setShowComparison(false);
                setFieldName('Value');
                if (fileInputRef.current) {
                    fileInputRef.current.value = '';
                }
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <div className="gradient-bg text-white py-8 shadow-lg relative">
                        <LanguageSelector language={language} setLanguage={setLanguage} />
                        <div className="container mx-auto px-4">
                            <h1 className="text-3xl font-bold text-center">{t('title')}</h1>
                            <p className="text-center mt-2 text-purple-100">{t('subtitle')}</p>
                        </div>
                    </div>

                    <div className="container mx-auto px-4 py-8 max-w-6xl">
                        {/* Upload Area */}
                        {!inputFile && (
                            <div className="mb-8">
                                <div
                                    className={`file-drop-area border-4 border-dashed rounded-xl p-12 text-center cursor-pointer
                                        ${isDragging ? 'drag-over' : 'border-gray-300 hover:border-indigo-400'}`}
                                    onDragOver={handleDragOver}
                                    onDragLeave={handleDragLeave}
                                    onDrop={handleDrop}
                                    onClick={() => fileInputRef.current?.click()}
                                >
                                    <svg className="mx-auto h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                    </svg>
                                    <p className="text-xl mb-2">{t('dragDropTitle')}</p>
                                    <p className="text-gray-500">{t('dragDropSubtitle')}</p>
                                    <input
                                        ref={fileInputRef}
                                        type="file"
                                        accept=".lyrx"
                                        onChange={handleFileUpload}
                                        className="hidden"
                                    />
                                </div>
                            </div>
                        )}

                        {/* File Info and Conversion */}
                        {inputFile && (
                            <div className="space-y-6">
                                {/* File Info Card */}
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-xl font-semibold">{t('uploadedFile')}</h2>
                                        <button
                                            onClick={reset}
                                            className="text-red-500 hover:text-red-700 font-medium"
                                        >
                                            ‚úï {t('close')}
                                        </button>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <p className="text-sm text-gray-500">{t('fileName')}</p>
                                            <p className="font-medium">{inputFile.name}</p>
                                        </div>
                                        <div>
                                            <p className="text-sm text-gray-500">{t('detectedType')}</p>
                                            <p className="font-medium">
                                                {layerType === 'feature' && (
                                                    <span className="text-blue-600">üìç {t('featureLayer')}</span>
                                                )}
                                                {layerType === 'raster' && (
                                                    <span className="text-green-600">üó∫Ô∏è {t('rasterLayer')}</span>
                                                )}
                                                {layerType === 'unknown' && (
                                                    <span className="text-red-600">‚ùì {t('unknown')}</span>
                                                )}
                                            </p>
                                        </div>
                                    </div>

                                    {layerType !== 'unknown' && (
                                        <div className="mt-6 space-y-4">
                                            {layerType === 'feature' && (
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        {t('fieldNameLabel')}
                                                    </label>
                                                    <input
                                                        type="text"
                                                        value={fieldName}
                                                        onChange={(e) => setFieldName(e.target.value)}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                                        placeholder={t('fieldNamePlaceholder')}
                                                    />
                                                    <p className="text-xs text-gray-500 mt-1">
                                                        {t('fieldNameHelp')}
                                                    </p>
                                                </div>
                                            )}
                                            
                                            <button
                                                onClick={performConversion}
                                                className="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-indigo-700 transition-colors"
                                            >
                                                {layerType === 'feature' 
                                                    ? t('convertToRaster')
                                                    : t('convertToFeature')}
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Conversion Log */}
                                {conversionLog.length > 0 && (
                                    <div className="bg-white rounded-lg shadow-md p-6">
                                        <h3 className="text-lg font-semibold mb-3">{t('conversionLog')}</h3>
                                        <div className="bg-gray-50 rounded p-4 max-h-60 overflow-y-auto">
                                            {conversionLog.map((log, index) => (
                                                <div 
                                                    key={index} 
                                                    className="text-sm py-1"
                                                    style={{
                                                        color: log.includes('‚úì') ? '#10b981' : 
                                                               log.includes('‚úÖ') ? '#059669' :
                                                               log.includes('üîÑ') ? '#3b82f6' : '#6b7280'
                                                    }}
                                                >
                                                    {log}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Download Section */}
                                {outputContent && (
                                    <div className="bg-green-50 border-2 border-green-200 rounded-lg p-6">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <h3 className="text-lg font-semibold text-green-800">
                                                    {t('conversionSuccess')}
                                                </h3>
                                                <p className="text-green-600 mt-1">
                                                    {t('fileConverted')} {convertedType === 'raster' ? t('rasterLayer') : t('featureLayer')}
                                                </p>
                                            </div>
                                            <button
                                                onClick={downloadConvertedFile}
                                                className="bg-green-600 text-white py-2 px-6 rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center gap-2"
                                            >
                                                <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                                </svg>
                                                {t('download')}
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* Comparison View */}
                                {showComparison && inputContent && outputContent && (
                                    <div className="bg-white rounded-lg shadow-md p-6">
                                        <h3 className="text-lg font-semibold mb-4">{t('structureComparison')}</h3>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <h4 className="font-medium text-sm text-gray-600 mb-2">{t('original')} ({layerType})</h4>
                                                <div className="bg-gray-50 p-3 rounded border border-gray-200 max-h-96 overflow-auto">
                                                    <pre className="json-viewer text-xs">
                                                        {JSON.stringify({
                                                            type: inputContent.layerDefinitions[0].type,
                                                            hasRenderer: !!inputContent.layerDefinitions[0].renderer,
                                                            hasColorizer: !!inputContent.layerDefinitions[0].colorizer,
                                                            hasFeatureTable: !!inputContent.layerDefinitions[0].featureTable,
                                                            hasDataConnection: !!inputContent.layerDefinitions[0].dataConnection,
                                                            hasAttributeTable: !!inputContent.layerDefinitions[0].attributeTable
                                                        }, null, 2)}
                                                    </pre>
                                                </div>
                                            </div>
                                            <div>
                                                <h4 className="font-medium text-sm text-gray-600 mb-2">{t('converted')} ({convertedType})</h4>
                                                <div className="bg-blue-50 p-3 rounded border border-blue-200 max-h-96 overflow-auto">
                                                    <pre className="json-viewer text-xs">
                                                        {JSON.stringify({
                                                            type: outputContent.layerDefinitions[0].type,
                                                            hasRenderer: !!outputContent.layerDefinitions[0].renderer,
                                                            hasColorizer: !!outputContent.layerDefinitions[0].colorizer,
                                                            hasFeatureTable: !!outputContent.layerDefinitions[0].featureTable,
                                                            hasDataConnection: !!outputContent.layerDefinitions[0].dataConnection,
                                                            hasAttributeTable: !!outputContent.layerDefinitions[0].attributeTable
                                                        }, null, 2)}
                                                    </pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Instructions */}
                        <div className="mt-12 bg-white rounded-lg shadow-md p-6">
                            <h3 className="text-xl font-semibold mb-4">{t('instructions')}</h3>
                            <div className="space-y-3 text-gray-700">
                                <div className="flex gap-3">
                                    <span className="text-2xl">1Ô∏è‚É£</span>
                                    <p>{t('step1')}</p>
                                </div>
                                <div className="flex gap-3">
                                    <span className="text-2xl">2Ô∏è‚É£</span>
                                    <p>{t('step2')}</p>
                                </div>
                                <div className="flex gap-3">
                                    <span className="text-2xl">3Ô∏è‚É£</span>
                                    <p>{t('step3')}</p>
                                </div>
                                <div className="flex gap-3">
                                    <span className="text-2xl">4Ô∏è‚É£</span>
                                    <p>{t('step4')}</p>
                                </div>
                            </div>
                            
                            <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                                <h4 className="font-semibold text-blue-900 mb-2">{t('importantInfo')}</h4>
                                <ul className="text-sm text-blue-800 space-y-1">
                                    <li>{t('info1')}</li>
                                    <li>{t('info2')}</li>
                                    <li>{t('info3')}</li>
                                    <li>{t('info4')}</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    {/* Footer */}
                    <footer className="mt-16 py-6 bg-gray-100 text-center text-gray-600">
                        <p>{t('footer')}</p>
                        <div className="mt-4" dangerouslySetInnerHTML={{__html: 
                            language === 'es' 
                                ? `<p xmlns:cc="http://creativecommons.org/ns#">
                                    Este trabajo de <span property="cc:attributionName">I√±aki Moro</span> 
                                    est√° bajo una licencia <a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"></a>
                                  </p>`
                                : `<p xmlns:cc="http://creativecommons.org/ns#">
                                    This work by <span property="cc:attributionName">I√±aki Moro</span> 
                                    is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY 4.0 License<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"></a>
                                  </p>`
                        }} />
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<LyrxConverter />, document.getElementById('root'));
    </script>
</body>
</html>